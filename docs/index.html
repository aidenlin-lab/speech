<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>çŒœæ•¸å­—éŠæˆ²</title>
  <style>
    :root{
      --bg: #0f172a;        /* æ·±è‰²èƒŒæ™¯ */
      --fg: #e2e8f0;        /* æ–‡å­— */
      --muted:#94a3b8;      /* æ¬¡è¦æ–‡å­— */
      --card:#111827;       /* å¡ç‰‡åº• */
      --accent:#22c55e;     /* è´ */
      --warn:#f59e0b;       /* æç¤º */
      --err:#ef4444;        /* éŒ¯èª¤/è¼¸ */
      --info:#3b82f6;       /* ä¸€èˆ¬é‡é» */
      --chip:#1f2937;       /* ç´€éŒ„ç±¤ */
      --border:#334155;     /* é‚Šæ¡† */
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f8fafc;
        --fg:#0f172a;
        --muted:#475569;
        --card:#ffffff;
        --chip:#f1f5f9;
        --border:#e2e8f0;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 70% -10%, #1e293b 0%, var(--bg) 60%);
      color:var(--fg);
      display:grid;
      place-items:center;
      padding:20px;
    }
    .wrap{
      width:min(920px, 100%);
      display:grid;
      gap:16px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    h1{
      margin:0 0 6px;
      letter-spacing:.02em;
      font-weight:800;
      font-size:clamp(22px, 3.8vw, 36px);
    }
    .sub{color:var(--muted); margin-top:0}
    .row{display:flex; flex-wrap:wrap; gap:12px; align-items:center}
    .row > *{flex:1}
    .row .shrink{flex:0}
    label{font-size:.9rem; color:var(--muted)}
    input[type="number"], select{
      width:100%;
      padding:12px 14px;
      background:transparent;
      color:var(--fg);
      border:1px solid var(--border);
      border-radius:12px;
      outline:none;
    }
    input[type="number"]:focus, select:focus{border-color:var(--info); box-shadow:0 0 0 4px rgba(59,130,246,.15)}
    .btn{
      appearance:none;
      border:1px solid var(--border);
      padding:12px 18px;
      border-radius:12px;
      background:linear-gradient(180deg, #0ea5e9, #2563eb);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      transition:transform .05s ease, filter .2s ease, opacity .2s ease;
      white-space:nowrap;
    }
    .btn.secondary{
      background:transparent;
      color:var(--fg);
    }
    .btn:disabled{opacity:.5; cursor:not-allowed; filter:grayscale(.2)}
    .btn:active{transform:translateY(1px)}
    .status{
      display:flex; align-items:center; gap:10px;
      padding:12px 14px; border-radius:12px; border:1px dashed var(--border);
      background: rgba(59,130,246,.07);
      min-height:56px;
    }
    .status.ok{background: rgba(34,197,94,.10); border-color:rgba(34,197,94,.45)}
    .status.warn{background: rgba(245,158,11,.10); border-color:rgba(245,158,11,.45)}
    .status.err{background: rgba(239,68,68,.10); border-color:rgba(239,68,68,.45)}
    .status b{font-weight:800}
    .meter{
      height:10px; width:100%;
      background:linear-gradient(90deg, #0ea5e9, #22c55e);
      border-radius:999px;
      transform-origin:left;
      transform:scaleX(var(--x, 0));
      transition:transform .3s ease;
    }
    .hist{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      background:var(--chip);
      border:1px solid var(--border);
      padding:6px 10px;
      border-radius:999px;
      font-size:.9rem;
    }
    .footer{display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; color:var(--muted)}
    .kbd{
      border:1px solid var(--border);
      background:var(--chip);
      padding:2px 6px; border-radius:6px; font-weight:700;
    }
    .sr{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>çŒœæ•¸å­—éŠæˆ²</h1>
      <p class="sub">å¾æŒ‡å®šç¯„åœå…§çŒœå‡ºéš¨æ©Ÿæ•´æ•¸ã€‚ç”¨æœ€å°‘æ¬¡æ•¸å®ŒæˆæŒ‘æˆ°ï¼</p>

      <!-- éŠæˆ²è¨­å®š -->
      <div class="row" style="margin-top:6px">
        <div>
          <label for="range">ç¯„åœ</label>
          <select id="range" aria-label="é¸æ“‡æ•¸å­—ç¯„åœ">
            <option value="100">1 ~ 100ï¼ˆç¶“å…¸ï¼‰</option>
            <option value="500">1 ~ 500ï¼ˆå›°é›£ï¼‰</option>
            <option value="1000">1 ~ 1000ï¼ˆåœ°ç„ï¼‰</option>
            <option value="50">1 ~ 50ï¼ˆç†±èº«ï¼‰</option>
          </select>
        </div>
        <div>
          <label for="tries">æœ€å¤§æ¬¡æ•¸</label>
          <select id="tries" aria-label="é¸æ“‡æœ€å¤§å˜—è©¦æ¬¡æ•¸">
            <option value="8">8 æ¬¡</option>
            <option value="10" selected>10 æ¬¡</option>
            <option value="12">12 æ¬¡</option>
            <option value="15">15 æ¬¡</option>
          </select>
        </div>
        <div class="shrink" style="align-self:end">
          <button id="newGame" class="btn" type="button" aria-label="é–‹å§‹æ–°éŠæˆ²">é–‹å§‹ / é‡ä¾†</button>
        </div>
      </div>
    </section>

    <!-- äº’å‹•å€ -->
    <section class="card">
      <div class="row">
        <div>
          <label for="guess">è¼¸å…¥ä½ çš„çŒœæ¸¬</label>
          <input id="guess" type="number" inputmode="numeric" placeholder="è¼¸å…¥æ•¸å­—å¾ŒæŒ‰ Enter æˆ–é»æ“Šã€çŒœï¼ã€" min="1" />
        </div>
        <div class="shrink" style="align-self:end">
          <button id="submit" class="btn" type="button">çŒœï¼</button>
        </div>
        <div class="shrink" style="align-self:end">
          <button id="hintBtn" class="btn secondary" type="button" title="æ¶ˆè€— 1 æ¬¡æ©Ÿæœƒæ›ä¸€å€‹æç¤º">æç¤º</button>
        </div>
      </div>

      <div id="status" class="status" role="status" aria-live="polite" style="margin-top:12px">
        æº–å‚™å¥½äº†å°±æŒ‰ <b>é–‹å§‹ / é‡ä¾†</b>ï¼
      </div>

      <div style="margin-top:14px">
        <div class="meter" id="meter" style="--x: 0"></div>
        <div class="footer" style="margin-top:8px">
          <div>å‰©é¤˜æ¬¡æ•¸ï¼š<b id="left">â€”</b> / <span id="max">â€”</span></div>
          <div>ç¯„åœï¼š<b id="min">â€”</b> ~ <b id="maxN">â€”</b></div>
        </div>
      </div>
    </section>

    <!-- æ­·å²ç´€éŒ„ -->
    <section class="card">
      <h2 style="margin:0 0 8px;font-size:1.1rem">æ­·å²ç´€éŒ„</h2>
      <div id="history" class="hist" aria-live="polite" aria-atomic="false"></div>
      <p class="sub" style="margin-top:10px">å°æ’‡æ­¥ï¼šè¼¸å…¥å¾Œç›´æ¥æŒ‰ <span class="kbd">Enter</span> å¯å¿«é€Ÿé€å‡ºã€‚</p>
    </section>
  </main>

  <script>
    (() => {
      const $ = (id) => document.getElementById(id);
      const el = {
        range: $("range"),
        tries: $("tries"),
        newGame: $("newGame"),
        submit: $("submit"),
        hintBtn: $("hintBtn"),
        guess: $("guess"),
        status: $("status"),
        left: $("left"),
        max: $("max"),
        min: $("min"),
        maxN: $("maxN"),
        meter: $("meter"),
        history: $("history"),
      };

      /** éŠæˆ²ç‹€æ…‹ */
      const state = {
        target: null,
        min: 1,
        maxN: 100,
        maxTries: 10,
        left: 10,
        started: false,
        history: [],
        lowerBound: 1,
        upperBound: 100,
      };

      const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

      function resetUI() {
        el.history.innerHTML = "";
        el.status.className = "status";
        el.status.textContent = "æ–°éŠæˆ²å·²å°±ç·’ï¼Œç¥ä½ å¥½é‹ï¼";
        el.left.textContent = state.left;
        el.max.textContent = state.maxTries;
        el.min.textContent = state.lowerBound;
        el.maxN.textContent = state.upperBound;
        el.meter.style.setProperty("--x", 0);
        el.guess.value = "";
        el.guess.placeholder = `è«‹è¼¸å…¥ ${state.lowerBound} ~ ${state.upperBound} çš„æ•´æ•¸`;
        el.guess.disabled = false;
        el.submit.disabled = false;
        el.hintBtn.disabled = false;
        el.guess.focus();
      }

      function startNewGame() {
        state.maxN = Number(el.range.value);
        state.maxTries = Number(el.tries.value);
        state.left = state.maxTries;
        state.min = 1;
        state.target = rnd(1, state.maxN);
        state.history = [];
        state.started = true;
        state.lowerBound = 1;
        state.upperBound = state.maxN;
        resetUI();
      }

      function addHistory(n, resultText) {
        const chip = document.createElement("span");
        chip.className = "chip";
        chip.textContent = `#${state.maxTries - state.left + 1}ï¼š${n}ï¼ˆ${resultText}ï¼‰`;
        el.history.prepend(chip);
      }

      function setStatus(msg, type = "") {
        el.status.className = "status " + (type || "");
        el.status.innerHTML = msg;
      }

      function setProgress() {
        const used = state.maxTries - state.left;
        const x = Math.max(0, Math.min(1, used / state.maxTries));
        el.meter.style.setProperty("--x", x);
      }

      function endGame(win) {
        el.guess.disabled = true;
        el.submit.disabled = true;
        el.hintBtn.disabled = true;
        if (win) {
          setStatus(`ğŸ‰ <b>æ­å–œï¼</b> ä½ åœ¨ <b>${state.maxTries - state.left}</b> æ¬¡å…§çŒœä¸­ <b>${state.target}</b>ï¼`, "ok");
        } else {
          setStatus(`ğŸ˜µâ€ğŸ’« <b>å¯æƒœï¼</b> æ­£ç¢ºç­”æ¡ˆæ˜¯ <b>${state.target}</b>ï¼Œä¸‹æ¬¡ä¸€å®šå¯ä»¥ï¼`, "err");
        }
      }

      function heatHint(n) {
        const d = Math.abs(n - state.target);
        if (d === 0) return "å‘½ä¸­ï¼";
        const ratio = d / (state.maxN - 1);
        if (ratio <= 0.02) return "ğŸ”¥ è¶…ç‡™ï¼ˆéå¸¸æ¥è¿‘ï¼‰";
        if (ratio <= 0.05) return "ğŸŒ¶ï¸ å¾ˆç‡™ï¼ˆå¾ˆæ¥è¿‘ï¼‰";
        if (ratio <= 0.1) return "ğŸ™‚ æº«æº«çš„ï¼ˆæœ‰é»æ¥è¿‘ï¼‰";
        if (ratio <= 0.2) return "ğŸ˜ åé ï¼ˆå†è©¦è©¦ï¼‰";
        return "ğŸ¥¶ å¾ˆå†·ï¼ˆå·®å¾ˆå¤šï¼‰";
      }

      function validateInput(val) {
        if (val === "" || val === null) return "è«‹å…ˆè¼¸å…¥æ•¸å­—ã€‚";
        const n = Number(val);
        if (!Number.isInteger(n)) return "è«‹è¼¸å…¥æ•´æ•¸ã€‚";
        if (n < state.lowerBound || n > state.upperBound) {
          return `è«‹è¼¸å…¥ ${state.lowerBound} ~ ${state.upperBound} çš„æ•´æ•¸ã€‚`;
        }
        if (state.history.includes(n)) return "é€™å€‹æ•¸å­—ä½ å‰›å‰›çŒœéäº†ï¼Œæ›å€‹æ•¸å­—å§ï¼";
        return null;
      }

      function submitGuess() {
        if (!state.started) {
          setStatus("è«‹å…ˆæŒ‰ <b>é–‹å§‹ / é‡ä¾†</b> é–‹å§‹æ–°éŠæˆ²ã€‚", "warn");
          return;
        }
        const val = el.guess.value.trim();
        const err = validateInput(val);
        if (err) {
          setStatus(`âš ï¸ ${err}`, "warn");
          return;
        }
        const guess = Number(val);
        state.history.push(guess);
        state.left--;
        el.left.textContent = state.left;
        setProgress();

        if (guess === state.target) {
          addHistory(guess, "å‘½ä¸­");
          setStatus(`âœ… <b>ç­”å°äº†ï¼</b> ${heatHint(guess)}`, "ok");
          endGame(true);
          return;
        }

        // é«˜ä½æç¤º + å‹•æ…‹èª¿æ•´å»ºè­°å€é–“
        if (guess > state.target) {
          state.upperBound = Math.min(state.upperBound, guess - 1);
          addHistory(guess, "å¤ªå¤§");
          setStatus(`â¬‡ï¸ å¤ªå¤§äº†ï¼å»ºè­°æ”¹çŒœ <b>${state.lowerBound} ~ ${state.upperBound}</b>ã€‚<br>${heatHint(guess)}`, "warn");
        } else {
          state.lowerBound = Math.max(state.lowerBound, guess + 1);
          addHistory(guess, "å¤ªå°");
          setStatus(`â¬†ï¸ å¤ªå°äº†ï¼å»ºè­°æ”¹çŒœ <b>${state.lowerBound} ~ ${state.upperBound}</b>ã€‚<br>${heatHint(guess)}`, "warn");
        }

        el.min.textContent = state.lowerBound;
        el.maxN.textContent = state.upperBound;

        if (state.left <= 0) {
          endGame(false);
        } else {
          el.guess.select();
          el.guess.focus();
        }
      }

      function useHint() {
        if (!state.started) {
          setStatus("è«‹å…ˆé–‹å§‹éŠæˆ²å†ä½¿ç”¨æç¤ºã€‚", "warn");
          return;
        }
        if (state.left <= 1) {
          setStatus("å‰© 1 æ¬¡å°±ç•™è‘—æä¸€æŠŠå§ï¼", "warn");
          return;
        }
        // æ¶ˆè€— 1 æ¬¡ï¼Œçµ¦æ–¹å‘ + ç¸®å°å€é–“
        state.left--;
        el.left.textContent = state.left;
        setProgress();

        const mid = Math.floor((state.lowerBound + state.upperBound) / 2);
        let msg;
        if (state.target > mid) {
          state.lowerBound = Math.max(state.lowerBound, mid + 1);
          msg = `æç¤ºï¼šç­”æ¡ˆåœ¨ <b>${state.lowerBound}</b> åˆ° <b>${state.upperBound}</b> çš„<b>å³åŠé‚Š</b>ã€‚`;
        } else {
          state.upperBound = Math.min(state.upperBound, mid);
          msg = `æç¤ºï¼šç­”æ¡ˆåœ¨ <b>${state.lowerBound}</b> åˆ° <b>${state.upperBound}</b> çš„<b>å·¦åŠé‚Š</b>ã€‚`;
        }
        el.min.textContent = state.lowerBound;
        el.maxN.textContent = state.upperBound;
        setStatus(`ğŸª„ ${msg}`, "info");
        el.guess.focus();
      }

      // ç¶å®šäº‹ä»¶
      el.newGame.addEventListener("click", startNewGame);
      el.submit.addEventListener("click", submitGuess);
      el.hintBtn.addEventListener("click", useHint);
      el.guess.addEventListener("keydown", (e) => {
        if (e.key === "Enter") submitGuess();
      });

      // åˆå§‹ç‹€æ…‹ï¼ˆç­‰å¾…é–‹å§‹ï¼‰
      setStatus("æº–å‚™å¥½äº†å°±æŒ‰ <b>é–‹å§‹ / é‡ä¾†</b>ï¼");

      // ç„¡éšœç¤™ï¼šåœ¨ç‹€æ…‹åˆ‡æ›æ™‚åŠ ä¸Šæè¿°ç”¨é€”
      const infoClass = CSS && CSS.supports && CSS.supports("background: color(display-p3 1 1 1)") ? "info" : "";
    })();
  </script>
</body>
</html>
